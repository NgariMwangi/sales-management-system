{% extends "base.html" %}
{% block title %}Order {{ order.order_number }}{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Order {{ order.order_number }}</h2>
    <div>
        <a href="{{ url_for('orders.pdf', order_id=order.id) }}" class="btn btn-outline-danger me-2" download>Export PDF</a>
        <a href="{{ url_for('orders.invoice', order_id=order.id) }}" class="btn btn-outline-primary me-2" target="_blank">Print Invoice</a>
        {% if order.payment_status in ['paid', 'partial'] %}
        <div class="btn-group me-2">
            <a href="{{ url_for('orders.receipt', order_id=order.id, format='a4') }}" class="btn btn-outline-success" download>Receipt (A4)</a>
            <a href="{{ url_for('orders.receipt', order_id=order.id, format='thermal') }}" class="btn btn-outline-success" download>Receipt (Thermal)</a>
        </div>
        {% endif %}
        {% if order.order_status != 'completed' and (current_user.role in ['admin','manager','sales']) %}
        <a href="{{ url_for('orders.edit', order_id=order.id) }}" class="btn btn-primary">Edit</a>
        {% endif %}
    </div>
</div>
<div class="row">
    <div class="col-md-6">
        <p><strong>Customer:</strong> {{ order.customer_name }}</p>
        <p><strong>Phone:</strong> {{ order.phone or '-' }}</p>
        <p><strong>Email:</strong> {{ order.email or '-' }}</p>
        <p><strong>Date:</strong> {{ order.order_date }}</p>
    </div>
    <div class="col-md-6">
        <p><strong>Payment:</strong> <span class="badge bg-secondary">{{ order.payment_status }}</span> {{ order.payment_method or '' }}</p>
        <p><strong>Order Status:</strong> <span class="badge bg-info">{{ order.order_status }}</span></p>
        <p><strong>Delivery Status:</strong> {{ order.delivery_status or '-' }}</p>
    </div>
</div>
{% if order.notes %}<p><strong>Notes:</strong> {{ order.notes }}</p>{% endif %}
<table class="table mt-3">
    <thead><tr><th>Product</th><th>Qty</th><th>Price</th><th>Subtotal</th></tr></thead>
    <tbody>
    {% for oi in order.items %}
    <tr>
        <td>{{ oi.product_name }}{% if oi.is_manual_entry %} <span class="badge bg-light text-dark">Manual</span>{% endif %}</td>
        <td>{{ oi.quantity }}</td>
        <td>{{ "%.2f"|format(oi.selling_price|float) }}</td>
        <td>{{ "%.2f"|format(oi.subtotal|float) }}</td>
    </tr>
    {% endfor %}
    </tbody>
</table>
<p class="text-end">
    Subtotal: {{ "%.2f"|format(order.total_amount|float) }} |
    Discount: {{ "%.2f"|format(order.discount|float) }} |
    Tax: {{ "%.2f"|format(order.tax|float) }} |
    <strong>Grand Total: {{ "%.2f"|format(order.grand_total|float) }}</strong>
</p>
<a href="{{ url_for('orders.list') }}" class="btn btn-secondary">Back to Orders</a>
{% endblock %}
