{% extends "base.html" %}
{% block title %}Quotation {{ quotation.quotation_number }}{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Quotation {{ quotation.quotation_number }}</h2>
    <div>
        <a href="{{ url_for('quotations.pdf', quotation_id=quotation.id) }}" class="btn btn-outline-danger me-2" download>Export PDF</a>
        {% if quotation.status in ['draft','sent'] %}
        <form action="{{ url_for('quotations.convert_to_order', quotation_id=quotation.id) }}" method="post" class="d-inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-success">Convert to Order</button>
        </form>
        {% endif %}
        <a href="{{ url_for('quotations.edit', quotation_id=quotation.id) }}" class="btn btn-primary">Edit</a>
    </div>
</div>
<p><strong>Customer:</strong> {{ quotation.customer_name }} | <strong>Valid Until:</strong> {{ quotation.valid_until or '-' }} | <strong>Status:</strong> {{ quotation.status }}</p>
<table class="table">
    <thead><tr><th>Product</th><th>Qty</th><th>Unit Price</th><th>Disc %</th><th>Subtotal</th></tr></thead>
    <tbody>
    {% for qi in quotation.items %}
    <tr>
        <td>{{ qi.product_name }}</td>
        <td>{{ qi.quantity }}</td>
        <td>{{ "%.2f"|format(qi.unit_price|float) }}</td>
        <td>{{ "%.2f"|format(qi.discount_percent|float) }}</td>
        <td>{{ "%.2f"|format(qi.subtotal|float) }}</td>
    </tr>
    {% endfor %}
    </tbody>
</table>
<p class="text-end"><strong>Grand Total: {{ "%.2f"|format(quotation.grand_total|float) }}</strong></p>
<a href="{{ url_for('quotations.list') }}" class="btn btn-secondary">Back</a>
{% endblock %}
